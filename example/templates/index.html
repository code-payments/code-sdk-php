<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code SDK - Python Flask Example</title>
</head>

<body>
  <div id="button-container"></div>

  <script type="module">
    import code from 'https://js.getcode.com/v1';

    const { button } = code.elements.create('button', {
      currency: 'usd',
      destination: 'E8otxw1CVX9bfyddKu3ZB3BVLa4VVF9J7CTPdnUwT9jR',
      amount: 0.05, // Minimum amount is $0.05 USD
      confirmParams: {
        success: {
          // The URL to redirect to after a successful payment. The
          // {{INTENT_ID}} placeholder will be filled in automatically.

          url: '/verify/{{INTENT_ID}}',
        },

        // You can optionally specify a cancel URL to redirect to if the user
        // cancels the payment on either their Code app or on the browser.

        // cancel: { url: '...' }
      },
    });

    button.on('invoke', async () => {
      // This is called when the "Pay with Code" button is clicked.

      // Get a payment intent from our own server. We're not just going to trust
      // the front-end to charge the correct amount and to the correct
      // destination.
      const res = await fetch('/create-intent', { method: 'POST' });
      const { clientSecret } = await res.json();

      // Update the button with the new client secret generated by the server.
      button.update({ clientSecret });

      // return true; // Return true to cancel the payment intent (if needed)
    })

    button.mount('#button-container');
  </script>
</body>

</html>